<!DOCTYPE html>
<html lang="no">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VG BUD - Salgskjema</title>
    <style>
        :root { --primary: #d32f2f; --success: #2e7d32; --bg: #f8f9fa; --text: #333; }
        body { font-family: -apple-system, system-ui, sans-serif; background: var(--bg); color: var(--text); padding: 15px; display: flex; justify-content: center; }
        .card { background: white; width: 100%; max-width: 400px; padding: 25px; border-radius: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
        h2 { text-align: center; color: var(--primary); margin-top: 0; font-weight: 900; letter-spacing: 1px; }
        .group { margin-bottom: 18px; }
        label { display: block; font-weight: bold; margin-bottom: 6px; font-size: 0.9em; }
        input, select { width: 100%; padding: 12px; border: 2px solid #eee; border-radius: 10px; box-sizing: border-box; font-size: 16px; transition: 0.3s; }
        input:focus { border-color: var(--primary); outline: none; }
        .calc-box { background: #fff5f5; padding: 15px; border-radius: 12px; border: 1px solid #ffebee; margin-top: 10px; }
        button { width: 100%; background: var(--primary); color: white; border: none; padding: 16px; border-radius: 10px; font-size: 18px; font-weight: bold; cursor: pointer; margin-top: 10px; }
        #status { display: none; text-align: center; }
        .result-item { margin: 10px 0; padding: 12px; border-radius: 10px; background: #f0f4f0; border: 1px solid #d4e3d4; text-align: left; }
        .money-val { font-weight: bold; float: right; }
        .summary-title { font-size: 0.9em; color: #666; }
    </style>
</head>
<body>

<div class="card">
    <div id="formContainer">
        <h2>ðŸ“° VG BUD</h2>
        <form id="paperForm">
            <div class="group">
                <label>Dag</label>
                <select name="day" id="daySelect" required>
                    <option value="LÃ¸rdag">LÃ¸rdag (14 aviser)</option>
                    <option value="SÃ¸ndag">SÃ¸ndag (11 aviser)</option>
                </select>
            </div>
            <div class="group">
                <label>Dato</label>
                <select name="date" id="dateDropdown" required></select>
            </div>
            <div class="group">
                <label>Antall bestilt</label>
                <input type="number" name="ordered" id="ordered" value="14" required>
            </div>

            <div class="calc-box">
                <label>Salg (antall aviser)</label>
                <input type="number" name="soldCash" id="soldCash" placeholder="Solgt kontant" required style="margin-bottom:10px">
                <input type="number" name="soldVipps" id="soldVipps" placeholder="Solgt pÃ¥ Vipps" required>
            </div>

            <div class="calc-box" style="background: #e3f2fd; border-color: #bbdefb;">
                <label>Tips (kroner)</label>
                <input type="number" name="tipsCash" id="tipsCash" placeholder="Tips i kontanter" value="0" style="margin-bottom:10px">
                <input type="number" name="tipsVipps" id="tipsVipps" placeholder="Tips pÃ¥ Vipps" value="0">
            </div>

            <button type="submit" id="submitBtn">LEGG INN</button>
        </form>
    </div>

    <div id="status">
        <h2>âœ… Lagret!</h2>
        <div class="result-item">
            <span class="summary-title">Opptjent i dag:</span>
            <span class="money-val" id="resEarned" style="color: var(--success);">0 kr</span>
        </div>
        <div class="result-item">
            <span class="summary-title" id="debtLabel">MellomvÃ¦rende:</span>
            <span class="money-val" id="resDebt">0 kr</span>
        </div>
        <div class="result-item" style="background: #fff3e0; border-color: #ffe0b2;">
            <span class="summary-title">Mamma mÃ¥ vippse VG:</span>
            <span class="money-val" id="resToVG" style="color: #e65100;">0 kr</span>
        </div>
        <button onclick="location.reload()" style="background: #eee; color: #333; font-size: 14px; margin-top:20px">Logg ny dag</button>
    </div>
</div>

<script>
    const scriptURL = 'https://script.google.com/macros/s/AKfycbzYp_p00-EMoT4_4Snw-thiReCor5_X5y65a6LmmURfZb8H8eyKPha7Nw7M__kKUSiJ/exec'; // LIM INN NY URL HER
    const form = document.getElementById('paperForm');
    
    // Auto-dato logikk
    const today = new Date();
    const daySelect = document.getElementById('daySelect');
    const orderedInput = document.getElementById('ordered');
    if (today.getDay() === 6) { daySelect.value = "LÃ¸rdag"; orderedInput.value = 14; } 
    else { daySelect.value = "SÃ¸ndag"; orderedInput.value = 11; }

    daySelect.addEventListener('change', () => { orderedInput.value = (daySelect.value === 'LÃ¸rdag') ? 14 : 11; });

    const dateDropdown = document.getElementById('dateDropdown');
    for (let i = 0; i < 14; i++) {
        let d = new Date(); d.setDate(today.getDate() - i);
        if (d.getDay() === 0 || d.getDay() === 6) {
            let opt = document.createElement('option');
            opt.value = d.toLocaleDateString('no-NO');
            opt.innerHTML = d.toLocaleDateString('no-NO', { weekday: 'short', day: 'numeric', month: 'short' });
            dateDropdown.appendChild(opt);
        }
    }

    form.addEventListener('submit', e => {
        e.preventDefault();
        const sCash = parseInt(document.getElementById('soldCash').value) || 0;
        const sVipps = parseInt(document.getElementById('soldVipps').value) || 0;
        const tCash = parseInt(document.getElementById('tipsCash').value) || 0;
        const tVipps = parseInt(document.getElementById('tipsVipps').value) || 0;
        
        const totalSold = sCash + sVipps;
        const totalTips = tCash + tVipps;
        const earningsToday = (totalSold * 22) + totalTips;
        const toVG = totalSold * 33;
        const faktiskeVippsKroner = (sVipps * 55) + tVipps;
        const diff = faktiskeVippsKroner - earningsToday;

        document.getElementById('submitBtn').disabled = true;
        document.getElementById('submitBtn').innerText = "Lagrer...";

        fetch(scriptURL, { method: 'POST', body: new FormData(form)})
            .then(() => {
                document.getElementById('resEarned').innerText = earningsToday + " kr";
                document.getElementById('resToVG').innerText = toVG + " kr";
                
                const dLabel = document.getElementById('debtLabel');
                const dRes = document.getElementById('resDebt');
                if (diff < 0) {
                    dLabel.innerText = "Mamma skylder deg:";
                    dRes.innerText = Math.abs(diff) + " kr";
                    dRes.style.color = "green";
                } else {
                    dLabel.innerText = "Du skylder Mamma:";
                    dRes.innerText = diff + " kr";
                    dRes.style.color = "red";
                }

                document.getElementById('formContainer').style.display = 'none';
                document.getElementById('status').style.display = 'block';
            })
            .catch(error => alert('Feil! PrÃ¸v igjen.'));
    });
</script>
</body>
</html>
